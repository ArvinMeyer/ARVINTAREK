{% extends "base.html" %}

{% block title %}Manage Emails - Email Extraction System{% endblock %}

{% block content %}
<div class="px-4 py-6 sm:px-0 max-w-6xl mx-auto">
    <!-- Header -->
    <div class="mb-8">
        <h1 class="text-3xl font-bold text-gray-900">Manage Emails</h1>
        <p class="text-sm text-gray-500 mt-2">Add emails manually or import from CSV</p>
    </div>

    <!-- Tabs -->
    <div class="mb-6">
        <div class="border-b border-gray-200">
            <nav class="-mb-px flex space-x-8">
                <button onclick="showTab('manual')" id="tab-manual" class="tab-button border-blue-500 text-blue-600 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                    âž• Add Manually
                </button>
                <button onclick="showTab('import')" id="tab-import" class="tab-button border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                    ðŸ“¥ Import CSV
                </button>
                <button onclick="showTab('export')" id="tab-export" class="tab-button border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                    ðŸ“¤ Export CSV
                </button>
            </nav>
        </div>
    </div>

    <!-- Manual Entry Tab -->
    <div id="panel-manual" class="tab-panel">
        <div class="bg-white shadow-lg rounded-lg p-6">
            <h2 class="text-xl font-semibold text-gray-900 mb-4">Add Emails Manually</h2>
            <p class="text-sm text-gray-600 mb-6">Enter one email per line or separate multiple emails with commas</p>
            
            <form id="manual-form" method="POST" action="/emails/manual/add">
                <div class="mb-4">
                    <label for="emails-input" class="block text-sm font-medium text-gray-700 mb-2">
                        Email Addresses <span class="text-red-500">*</span>
                    </label>
                    <textarea id="emails-input" name="emails" rows="10" required
                              class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent font-mono text-sm"
                              placeholder="example1@domain.com&#10;example2@domain.com&#10;example3@domain.com"></textarea>
                    <p class="mt-1 text-xs text-gray-500">You can paste multiple emails, one per line or separated by commas</p>
                </div>
                
                <div class="mb-4">
                    <label for="source-url" class="block text-sm font-medium text-gray-700 mb-2">
                        Source URL (Optional)
                    </label>
                    <input type="url" id="source-url" name="source_url"
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                           placeholder="https://example.com/contact">
                    <p class="mt-1 text-xs text-gray-500">Where these emails were found (optional)</p>
                </div>
                
                <div class="flex items-center mb-4">
                    <input type="checkbox" id="validate-immediately" name="validate_immediately" checked
                           class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                    <label for="validate-immediately" class="ml-2 block text-sm text-gray-700">
                        Validate emails immediately after adding
                    </label>
                </div>
                
                <div class="flex justify-end space-x-4">
                    <button type="button" onclick="clearForm()" class="px-6 py-2 border border-gray-300 rounded-lg text-gray-700 bg-white hover:bg-gray-50 font-medium">
                        Clear
                    </button>
                    <button type="submit" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-medium">
                        Add Emails
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Import CSV Tab -->
    <div id="panel-import" class="tab-panel hidden">
        <div class="bg-white shadow-lg rounded-lg p-6">
            <h2 class="text-xl font-semibold text-gray-900 mb-4">Import Emails from CSV</h2>
            <p class="text-sm text-gray-600 mb-6">Upload a CSV file with email addresses. The CSV should have an 'email' column (case-insensitive).</p>
            
            <form id="import-form" method="POST" action="/emails/import" enctype="multipart/form-data">
                <div class="mb-4">
                    <label for="csv-file" class="block text-sm font-medium text-gray-700 mb-2">
                        CSV File <span class="text-red-500">*</span>
                    </label>
                    <input type="file" id="csv-file" name="csv_file" accept=".csv" required
                           class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100">
                    <p class="mt-1 text-xs text-gray-500">CSV file must contain an 'email' column</p>
                </div>
                
                <div class="mb-4">
                    <label for="import-source-url" class="block text-sm font-medium text-gray-700 mb-2">
                        Source URL (Optional)
                    </label>
                    <input type="url" id="import-source-url" name="source_url"
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                           placeholder="https://example.com/contact">
                    <p class="mt-1 text-xs text-gray-500">Where these emails came from (optional)</p>
                </div>
                
                <div class="flex items-center mb-4">
                    <input type="checkbox" id="import-validate" name="validate_immediately" checked
                           class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                    <label for="import-validate" class="ml-2 block text-sm text-gray-700">
                        Validate emails immediately after importing
                    </label>
                </div>
                
                <div class="mb-4 p-4 bg-blue-50 rounded-lg border border-blue-200">
                    <h3 class="text-sm font-semibold text-blue-900 mb-2">CSV Format Example:</h3>
                    <pre class="text-xs text-blue-800 bg-white p-2 rounded border border-blue-200">email,source
example1@domain.com,https://example.com
example2@domain.com,https://example.com</pre>
                </div>
                
                <div class="flex justify-end space-x-4">
                    <button type="button" onclick="clearImportForm()" class="px-6 py-2 border border-gray-300 rounded-lg text-gray-700 bg-white hover:bg-gray-50 font-medium">
                        Clear
                    </button>
                    <button type="submit" class="px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 font-medium">
                        Import CSV
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Export Tab -->
    <div id="panel-export" class="tab-panel hidden">
        <div class="bg-white shadow-lg rounded-lg p-6">
            <h2 class="text-xl font-semibold text-gray-900 mb-4">Export Emails to CSV</h2>
            <p class="text-sm text-gray-600 mb-6">Export your emails to a CSV file for backup or use in other tools</p>
            
            <div class="space-y-4">
                <div class="p-4 bg-gray-50 rounded-lg border border-gray-200">
                    <h3 class="text-sm font-semibold text-gray-900 mb-3">Export Options:</h3>
                    <div class="space-y-3">
                        <a href="/emails/export?type=valid" class="block px-4 py-3 bg-green-50 hover:bg-green-100 rounded-lg border border-green-200 transition-colors">
                            <div class="flex items-center justify-between">
                                <div>
                                    <div class="font-medium text-green-900">Valid Emails</div>
                                    <div class="text-xs text-green-700 mt-1">Export all validated, valid emails</div>
                                </div>
                                <svg class="w-5 h-5 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                                </svg>
                            </div>
                        </a>
                        
                        <a href="/emails/export?type=all" class="block px-4 py-3 bg-blue-50 hover:bg-blue-100 rounded-lg border border-blue-200 transition-colors">
                            <div class="flex items-center justify-between">
                                <div>
                                    <div class="font-medium text-blue-900">All Emails</div>
                                    <div class="text-xs text-blue-700 mt-1">Export all emails (valid, invalid, and unvalidated)</div>
                                </div>
                                <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                                </svg>
                            </div>
                        </a>
                        
                        <a href="/emails/export?type=invalid" class="block px-4 py-3 bg-red-50 hover:bg-red-100 rounded-lg border border-red-200 transition-colors">
                            <div class="flex items-center justify-between">
                                <div>
                                    <div class="font-medium text-red-900">Invalid Emails</div>
                                    <div class="text-xs text-red-700 mt-1">Export all invalid emails</div>
                                </div>
                                <svg class="w-5 h-5 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                                </svg>
                            </div>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function showTab(tabName) {
    // Hide all panels
    document.querySelectorAll('.tab-panel').forEach(panel => {
        panel.classList.add('hidden');
    });
    
    // Remove active class from all tabs
    document.querySelectorAll('.tab-button').forEach(btn => {
        btn.classList.remove('border-blue-500', 'text-blue-600');
        btn.classList.add('border-transparent', 'text-gray-500');
    });
    
    // Show selected panel
    document.getElementById(`panel-${tabName}`).classList.remove('hidden');
    
    // Add active class to selected tab
    const activeTab = document.getElementById(`tab-${tabName}`);
    activeTab.classList.remove('border-transparent', 'text-gray-500');
    activeTab.classList.add('border-blue-500', 'text-blue-600');
}

function clearForm() {
    document.getElementById('emails-input').value = '';
    document.getElementById('source-url').value = '';
}

function clearImportForm() {
    document.getElementById('csv-file').value = '';
    document.getElementById('import-source-url').value = '';
}

// Handle form submissions
document.getElementById('manual-form').addEventListener('submit', function(e) {
    const emails = document.getElementById('emails-input').value.trim();
    if (!emails) {
        e.preventDefault();
        alert('Please enter at least one email address');
        return false;
    }
});

document.getElementById('import-form').addEventListener('submit', function(e) {
    const file = document.getElementById('csv-file').files[0];
    if (!file) {
        e.preventDefault();
        alert('Please select a CSV file');
        return false;
    }
});
</script>
{% endblock %}

